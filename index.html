<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Bảng phân công công việc</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
}

h1 {
    margin-bottom: 10px;
}

input, button {
    padding: 6px;
    margin: 4px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    border: 1px solid #999;
    padding: 8px;
    text-align: center;
}

th {
    background: #f2f2f2;
}

.task {
    cursor: pointer;
    color: blue;
    text-decoration: underline;
}

.hidden {
    display: none;
}

.note {
    font-size: 12px;
    color: green;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
    <h1>Đăng nhập</h1>
    <input id="user" type="text" placeholder="Tài khoản">
    <input id="pass" type="password" placeholder="Mật khẩu">
    <button onclick="login()">Đăng nhập</button>
</div>

<!-- ADMIN -->
<div id="adminBox" class="hidden">
    <h1>Admin - Thêm nhiệm vụ</h1>
    <input id="empName" placeholder="Tên nhân viên">
    <select id="day">
        <option>Thứ 2</option>
        <option>Thứ 3</option>
        <option>Thứ 4</option>
        <option>Thứ 5</option>
        <option>Thứ 6</option>
        <option>Thứ 7</option>
    </select>
    <input id="taskName" placeholder="Tên nhiệm vụ">
    <button onclick="addTask()">Thêm</button>
</div>

<!-- BẢNG -->
<div id="tableBox" class="hidden">
    <h1>Bảng phân công công việc</h1>

    <table>
        <thead>
            <tr>
                <th>Nhân viên</th>
                <th>Thứ 2</th>
                <th>Thứ 3</th>
                <th>Thứ 4</th>
                <th>Thứ 5</th>
                <th>Thứ 6</th>
                <th>Thứ 7</th>
                <th>Ghi chú</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
const accounts = {
    admin: { pass: "123", role: "admin" },
    thien: { pass: "123", role: "staff" }
};

let currentUser = "";

let data = JSON.parse(localStorage.getItem("tasks")) || {};

function login() {
    const u = user.value;
    const p = pass.value;

    if (!accounts[u] || accounts[u].pass !== p) {
        alert("Sai tài khoản hoặc mật khẩu");
        return;
    }

    currentUser = u;
    loginBox.classList.add("hidden");
    tableBox.classList.remove("hidden");

    if (accounts[u].role === "admin") {
        adminBox.classList.remove("hidden");
    }

    renderTable();
}

function addTask() {
    const emp = empName.value;
    const d = day.value;
    const t = taskName.value;

    if (!emp || !t) return alert("Nhập đủ thông tin");

    if (!data[emp]) data[emp] = {};
    if (!data[emp][d]) data[emp][d] = [];

    data[emp][d].push({
        name: t,
        done: false,
        time: ""
    });

    save();
    renderTable();
}

function renderTable() {
    tableBody.innerHTML = "";

    for (let emp in data) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${emp}</td>`;

        ["Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"].forEach(d => {
            const td = document.createElement("td");
            if (data[emp][d]) {
                data[emp][d].forEach((task, i) => {
                    const div = document.createElement("div");
                    div.className = "task";
                    div.textContent = task.name;
                    div.onclick = () => toggleTask(emp, d, i);
                    td.appendChild(div);
                });
            }
            tr.appendChild(td);
        });

        const note = document.createElement("td");
        let completed = 0, total = 0;
        for (let d in data[emp]) {
            data[emp][d].forEach(t => {
                total++;
                if (t.done) completed++;
            });
        }
        note.innerHTML = `<div class="note">${completed}/${total} hoàn thành</div>`;
        tr.appendChild(note);

        tableBody.appendChild(tr);
    }
}

function toggleTask(emp, day, index) {
    if (currentUser !== emp && accounts[currentUser].role !== "admin") return;

    const task = data[emp][day][index];
    task.done = !task.done;
    task.time = task.done ? new Date().toLocaleString() : "";
    save();
    renderTable();
}

function save() {
    localStorage.setItem("tasks", JSON.stringify(data));
}
</script>

</body>
</html>
